{% extends 'docs/base.html' %}
{% set git_doc = "build-windows.html" %}
{% set doc_title = _("Build on Windows") %}
{% block content %}
<div id="docs" class="container">
  <div class="row">
    <div class="col-md-8">
      <p>
        This page is for Microsoft Windows users who want to contribute to the development of
        <a href="/" title="MusicBrainz Picard">MusicBrainz Picard</a>
        or for other reasons want to be able to run Picard from source code.
        It explains how to install the 3rd party software needed to run from source
        and also to build the Picard for Windows installer executable.
      </p>
      <h1 id="requirements">Requirements</h1>
      <p>
        Picard development (i.e. Github's master branch) is now focused on Picard version 2,
        which uses Python 3 and PyQt5.
        However if you need to test something in Picard version 1,
        then a separate branch 1.4.x is available to run and this uses Python 2 and PqQt4.
        Instructions for building each environment are provided below.
      </p>

      <h2 id="source">Downloading Picard source</h2>

      <p>
        Install <a rel="nofollow" target="_blank" href="https://desktop.github.com/">GitHub Desktop</a>
        or an alternative Git tool of your choice and use it to create your own local Git clone of
        your own fork of the <a target="_blank" href="https://github.com/metabrainz/picard/">Picard's GitHub Repository</a>.
      </p>

      <hr/>

      <h2 id="python_picard2">Python for Picard version 2</h2>

      <h3 id="python35">Python 3.5 or newer</h3>

      <ul>
        <li>
          Download and install Python 3 for Windows from
          <a rel="nofollow" target="_blank" href="https://python.org/downloads/">https://python.org/downloads/</a>.
          The latest version is recommended, but if you already have Python 3 installed
          then the minimum version is 3.5.
        </li>
        <li>
          Python should add itself to your %PATH% environment variable,
          but if not add both the Python install directory and its scripts subdirectory to %PATH%
        </li>
      </ul>


      <h3 id="python3_packages">Python 3 packages</h3>

      <p>
         You need the following additional python packages to run Picard from source:
      </p>

      <ul>
        <li>libdiscid</li>
        <li>discid</li>
        <li>PyQt 5.7.1 or later</li>
        <li>Mutagen 1.37 or later</li>
      </ul>

      <p>
        To install libdiscid, download "libdiscid-0.6.1-win32.zip" from
        <a rel="nofollow" target="_blank" href="https://musicbrainz.org/doc/libdiscid">https://musicbrainz.org/doc/libdiscid</a>
        and put <i>discid.dll</i> in your
        <i>Windows\System32</i> folder (Windows 32-bit) or
        <i>Windows\SysWOW64</i> folder (Windows 64-bit).
      </p>

      <p>
        The easiest way to install the remaining packages is to open an Administrator command prompt,
        navigate to the Picard source directory and type:
      </p>
      <pre>pip3 install -r requirements.txt</pre>

      <p>
         Alternatively to install them individually run:
      </p>
      <pre>pip3 install discid
pip3 install PyQt5>=5.7.1
pip3 install Mutagen>=1.37</pre>

      <hr/>

      <h2 id="python_picard1">Python for Picard version 1</h2>

      <h3 id="python27">Python 2.7.x</h3>

      <ul>
        <li>
          Download and install Python 2.7.x for Windows from
          <a rel="nofollow" target="_blank" href="https://python.org/downloads/">https://python.org/downloads/</a>
        </li>
        <li>
          Python should add itself to your %PATH% environment variable,
          but if not add both the Python install directory and its scripts subdirectory to %PATH%
        </li>
      </ul>

      <h3 id="python2_packages">Python 2 packages</h3>

      <p>
         You need need the following additional python packages to run Picard version 1 from source:
      </p>

      <ul>
        <li>PyQt 4.10 or later</li>
        <li>libdiscid</li>
        <li>discid</li>
        <li>Mutagen 1.22 or later</li>
      </ul>

      <p>
        You need to install PyQt4 and libdiscid manually.
      </p>

      <ul>
        <li>PyQt4 - Riverbank Computing (authors of PyQt) no longer maintains an installation executable for the latest versions of PyQt.
          The most recent Windows installer, for PyQt v4.11.4, is suitable for Picard v1 and can be downloaded and run from SourceForge
          <a rel="nofollow" target="_blank" href="https://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.11.4/">https://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.11.4/</a>.</li>
        <li>
          libdiscid - Download "libdiscid-0.6.1-win32.zip" from
          <a rel="nofollow" target="_blank" href="https://musicbrainz.org/doc/libdiscid">https://musicbrainz.org/doc/libdiscid</a>
          and put <i>discid.dll</i> in your
          <i>Windows\System32</i> folder (Windows 32-bit) or .
          <i>Windows\SysWOW64</i> folder (Windows 64-bit).
        </li>
      </ul>

      <p>
        The easiest way to install Mutagen and discid is using PIP.
        PIP is included as standard in Python 2.7.9 or later - so this is a good reason to upgrade if you
        already have an earlier version of Python 2.7 installed.
        Alternatively you can install PIP separately on earlier versions or install the above packages manually.
      </p>

      <p>
        Assuming that you want to use PIP, open an Administrator command prompt, navigate to the Picard source directory and type:
      </p>

      <pre>pip2 install Mutagen>=1.22
pip2 install discid</pre>

      <p>
        <b>Note:</b> If you get an error message "'pip2' is not recognized as an internal or external command, operable program or batch file." try fixing this with:
        <pre>python -m ensurepip --default-pip</pre>
      </p>

      <hr/>

      <h1 id="running_picard_from_source">Running Picard From Source</h1>

      <h3 id="chromaprint">Chromaprint</h3>

      <p>
        If you want to run the Acoustid Scan function when running Picard from source, then you need to install
        the Chromaprint fpcalc program into your Picard source directory.
      </p>

      <ul>
        <li>
          Download <a rel="nofollow" href="https://github.com/acoustid/chromaprint/releases/download/v1.4.2/chromaprint-fpcalc-1.4.2-windows-x86_64.zip">the x86_64 windows zip file</a>
          from <a rel="nofollow" href="https://acoustid.org/chromaprint">https://acoustid.org/chromaprint</a>
        </li>
        <li>
          Unzip "chromaprint-fpcalc-1.1-win-i86.zip" and put "fpcalc.exe" to the picard subdirectory
          of your Picard source code directory
        </li>
      </ul>

      <h3 id="gettext">gettext</h3>

      <p>
        Picard uses gettext for internationalisation (i.e. for Picard to appear in your local language).
        To build the language mappings you need to install gettext.
      </p>

      <ul>
        <li>
          Download and install gettext from
          <a rel="nofollow" target="_blank" href="https://mlocati.github.io/articles/gettext-iconv-windows.html">https://mlocati.github.io/articles/gettext-iconv-windows.html</a>.
        </li>
        <li>
          Add the gettext folder to&nbsp;<code>%PATH%</code> (default <code>C:\Program&nbsp;Files\gettext-iconv\bin</code> or <code>C:\Program&nbsp;Files&nbsp;(x86)\gettext-iconv\bin</code>)
        </li>
        <li>
          From the Picard source directory run
          <pre>py setup.py build_locales -i</pre>
        </li>
      </ul>

      <p>
        After you have done this, you can run Picard directly from the sources using:
      </p>

      <pre>py tagger.py</pre>

      <hr/>

      <h1 id="building_the_installer">Building the Installer</h1>

      <p>
        If you want to build the Picard Windows installer executable you need additional Tools:
      </p>

      <h3 id="py2exe">py2exe</h3>

      <ul>
        <li>
          For Picard version 2 / Python 3.5+, download and install py2exe 0.9.2.0 by executing: "pip3 install py2exe"
        </li>
        <li>
          For Picard version 1 / Python 2.7, download and install "py2exe-0.6.9.win32-py2.7.exe" from <a rel="nofollow" href="https://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/">https://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/</a>
        </li>
      </ul>

      <h3 id="nsis">NSIS 2.46</h3>

      <ul>
        <li> <a rel="nofollow" href="http://nsis.sourceforge.net/Download">http://nsis.sourceforge.net/Download</a>
        </li>
        <li>Download and install "nsis-2.46-setup.exe"
        </li>
      </ul>

      <h3 id="visual-cpp">Visual C++</h3>

      <p>
        Picard will run from source using a python version of the Levenshtein Distance fuzzy string comparison,
        however to build the C version for inclusion in the executable package you will need to download and install the
        Microsoft C++ compiler suitable for the version of Picard / Python you are building for:
      </p>

      <h4 id="visual-cpp-py3">Python 2 - Visual C++ 2015 Community</h4>

      <p>
        For Picard version 2 / Python 3,
        download <a rel="nofollow" href="https://landinghub.visualstudio.com/visual-cpp-build-tools">Microsoft Visual C++ 14.0
        standalone: Visual C++ Build Tools 2015 (x86, x64, ARM) from https://landinghub.visualstudio.com/visual-cpp-build-tools</a>.
      </p>

      <p>
        When you install, select the Windows 8.1 SDK for compile to work.
      </p>

      <h4 id="visual-cpp-py2">Python 2 - Visual C++ 2008 Express</h4>

      <p>
        For Picard version 1 / Python 2,
        download <a rel="nofollow" href="https://download.microsoft.com/download/A/5/4/A54BADB6-9C3F-478D-8657-93B3FC9FE62D/vcsetup.exe">Visual C++ 2008 Express</a>.
      </p>

      <p>
        <b>Note:</b> There is also apparently a cut-down compiler specifically for compiling Python 2.7.x modules available at
        <a rel="nofollow" target="_blank" href="https://www.microsoft.com/en-gb/download/details.aspx?id=44266">https://www.microsoft.com/en-gb/download/details.aspx?id=44266</a>,
        though the author has not tried this.
      </p>

      <h3 id="visual_cpp">Visual C++</h3>

      <p>
        Before you can build the Python executable and installer, you need to build the astrcmp C extension and
        language internationalisation.
        Start the VS console using "Visual Studio 2008 Command Prompt" or "Visual C++ 2015 MSBuild Command Prompt",
        go to the Picard source directory and run these commands:
      </p>

      <pre>python setup.py build_ext -i
python setup.py build_locales -i</pre>

      <p>
        Then you need to copy the following files from Visual Studio to
        to the source code directory, so that py2exe can find them:
      </p>

      <ul>
        <li>
          Picard version 2 / Python 3 - msvcp140.dll from
          <i>C:\Program&nbsp;Files&nbsp;(x86)\Microsoft&nbsp;Visual&nbsp;Studio&nbsp;14.0\VC\redist\x86\Microsoft.VC140.CRT</i>
        </li>
        <li>
          Picard version 1 / Python 2 - msvcr90.dll and msvcp90.dll from
          <i>C:\Program&nbsp;Files&nbsp;(x86)\Microsoft&nbsp;Visual&nbsp;Studio&nbsp;9.0\VC\redist\x86\Microsoft.VC90.CRT</i>
        </li>
      </ul>

      <p>
        You also need copy discid.dll (libdiscid) to the Picard source.
      </p>

      <p>
        Then you can build the installer using this command:
      </p>
      <pre>python setup.py bdist_nsis</pre>

      <p>
        The setup is <i>installer\picard-setup-x.x.exe</i> and an executable for your system is <i>dist\picard.exe</i>, which
        you can use to create a desktop shortcut.
      </p>

      <h1 id="known_issues">Known Issues</h1>
      <p>
        It is possible that the resulting picard.exe does not show the proper file icon.
        This is probably a bug of py2exe on Vista.
        You can fix the icon with the tool
        <a rel="nofollow" href="http://angusj.com/resourcehacker/">Resource Hacker</a> or any other tool, that
        can edit the resources in executables.
      </p>

      <h1 id="support">Support</h1>
      <p>
        If these instructions do not work, please research and try to solve the problem yourself -
        and report the issue and answer in the
        <a target="_blank" href="https://tickets.metabrainz.org/">Metabrainz Ticketing system</a> under PICARD-WEBSITE
        and by submitting a PR against the
        <a target="_blank" href="https://github.com/metabrainz/picard-website/">Picard-Website Github Repository</a>.
        If you are unable to resolve the issue after research and need further help,
        please use IRC freenode/#metabrainz to request help from the development community.
      </p>

    </div>

    <div class="col-md-4">
      <div id="sidebar" class="hidden-xs">
        <ul class="nav" data-spy="affix" data-offset-top="200">
          <li class="active">
            <a href="#requirements">Requirements</a>
            <ul class="nav">
              <li>
                <a href="#source">Downloading Picard Source</a>
              </li>
              <li>
                <a href="#python_picard2">Python for Picard version 2</a>
                <ul class="nav">
                  <li><a href="#python35">Python 3.5+</a></li>
                  <li><a href="#python3_packages">Python 3 packages</a></li>
                </ul>
              </li>
              <li>
                <a href="#python_picard1">Python for Picard version 1</a>
                <ul class="nav">
                  <li><a href="#python27">Python 2.7.x</a></li>
                  <li><a href="#python2_packages">Python 2 packages</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href="#running_picard_from_source">Running Picard From Source</a>
            <ul class="nav">
              <li><a href="#chromaprint">Chromaprint </a></li>
              <li><a href="#gettext">gettext</a></li>
            </ul>
          </li>
          <li>
            <a href="#building_the_installer">Building the Installer</a>
            <ul class="nav">
              <li><a href="#py2exe">py2exe 0.6.9</a></li>
              <li><a href="#nsis">NSIS 2.46</a></li>
              <li><a href="#visual_cpp">Visual C++</a></li>
            </ul>
          </li>
          <li><a href="#known_issues">Known Issues</a></li>
          <li><a href="#support">Support</a></li>
        </ul>
        <!-- <a class="back-to-top" href="#top"> Back to top </a> -->
      </div>
    </div>
  </div>
</div>
{% endblock %}
